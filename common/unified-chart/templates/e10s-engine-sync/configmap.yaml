{{- $top := . -}}
{{- $values := $top.Values -}}
{{- if and $values.e10sEngineSync.enabled (not $values.e10sEngineSync.existingConfigMap) }}
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "e10sEngineSync.configmap.name" $top }}
  labels:
    {{- include "e10sEngineSync.labels" $top | nindent 4 }}
data:
  # Required: Frontegg API URL
  FRONTEGG_URL: {{ required ".Values.e10sEngineSync.frontegg.url is required" $values.e10sEngineSync.frontegg.url | quote }}
  # Required: SpiceDB address
  SPICEDB_ADDRESS: {{ required ".Values.e10sEngineSync.spicedb.address is required" $values.e10sEngineSync.spicedb.address | quote }}
  # Sync configuration
  SYNC_MODE: {{ $values.e10sEngineSync.sync.mode | quote }}
  MAX_SYNC_RETRIES: {{ $values.e10sEngineSync.sync.maxRetries | quote }}
  SYNC_RETRY_DELAY: {{ $values.e10sEngineSync.sync.retryDelay | quote }}
  # ZED CLI configuration
  ZED_KEYRING_PASSWORD: {{ $values.e10sEngineSync.zed.keyringPassword | quote }}
  ZED_IMPORT_BATCH_SIZE: {{ $values.e10sEngineSync.zed.importBatchSize | quote }}
  ZED_IMPORT_WORKERS: {{ $values.e10sEngineSync.zed.importWorkers | quote }}
  ZED_DELETE_BATCH_SIZE: {{ $values.e10sEngineSync.zed.deleteBatchSize | quote }}
  ZED_DELETE_BATCH_DELAY: {{ $values.e10sEngineSync.zed.deleteBatchDelay | quote }}
  ZED_DELETE_TIMEOUT_RETRY_DELAY: {{ $values.e10sEngineSync.zed.deleteTimeoutRetryDelay | quote }}
  {{- if $values.e10sEngineSync.entitlementsServiceUrl }}
  ENTITLEMENTS_SERVICE_URL: {{ $values.e10sEngineSync.entitlementsServiceUrl | quote }}
  {{- end }}
  {{- with $values.e10sEngineSync.configmap.additionalData }}
  {{- toYaml . | nindent 2 }}
  {{- end }}
{{- end }}

